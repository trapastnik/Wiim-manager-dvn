# –ü—Ä–æ–≥—Ä–µ—Å—Å –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ WiiM Web Control

## –°—Ç–∞—Ç—É—Å: –í –ø—Ä–æ—Ü–µ—Å—Å–µ (Phase 1 Frontend)

### –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞: 2025-12-20

---

## üéØ –¶–µ–ª—å

–†–∞–∑–±–∏—Ç—å –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ –º–æ–¥—É–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:
- –ß–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∫–æ–¥–∞
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏
- –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏

---

## üìä –¢–µ–∫—É—â–∞—è –°—Ç—Ä—É–∫—Ç—É—Ä–∞

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
```
public/
‚îú‚îÄ‚îÄ app.js          ‚ùå 2853 —Å—Ç—Ä–æ–∫–∏ (–º–æ–Ω–æ–ª–∏—Ç)
‚îú‚îÄ‚îÄ index.html
‚îî‚îÄ‚îÄ style.css

server.js           ‚ùå 1427 —Å—Ç—Ä–æ–∫ (–º–æ–Ω–æ–ª–∏—Ç)
storage.js          ‚ö†Ô∏è 424 —Å—Ç—Ä–æ–∫–∏
wiim-client.js      ‚úÖ 118 —Å—Ç—Ä–æ–∫
network-scanner.js  ‚úÖ 132 —Å—Ç—Ä–æ–∫–∏
```

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (Phase 1 - Frontend):
```
public/
‚îú‚îÄ‚îÄ app.js                          üìù –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª (backup: app.js.backup)
‚îú‚îÄ‚îÄ index.html                      üîÑ –ë—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω
‚îú‚îÄ‚îÄ style.css
‚îî‚îÄ‚îÄ js/                             ‚ú® –ù–û–í–ê–Ø –ú–û–î–£–õ–¨–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê
    ‚îú‚îÄ‚îÄ app-main.js                 ‚úÖ –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å (~50 —Å—Ç—Ä–æ–∫)
    ‚îú‚îÄ‚îÄ state/
    ‚îÇ   ‚îî‚îÄ‚îÄ AppState.js             ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º (~180 —Å—Ç—Ä–æ–∫)
    ‚îú‚îÄ‚îÄ api/
    ‚îÇ   ‚îú‚îÄ‚îÄ base-api.js             ‚úÖ –ë–∞–∑–æ–≤—ã–π API –∫–ª–∏–µ–Ω—Ç (~80 —Å—Ç—Ä–æ–∫)
    ‚îÇ   ‚îú‚îÄ‚îÄ players-api.js          ‚úÖ API –ø–ª–µ–µ—Ä–æ–≤ (~110 —Å—Ç—Ä–æ–∫)
    ‚îÇ   ‚îú‚îÄ‚îÄ media-api.js            ‚úÖ API –º–µ–¥–∏–∞ (~60 —Å—Ç—Ä–æ–∫)
    ‚îÇ   ‚îî‚îÄ‚îÄ config-api.js           ‚úÖ API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (~70 —Å—Ç—Ä–æ–∫)
    ‚îú‚îÄ‚îÄ ui/
    ‚îÇ   ‚îú‚îÄ‚îÄ messages.js             ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Å–æ–æ–±—â–µ–Ω–∏–π (~40 —Å—Ç—Ä–æ–∫)
    ‚îÇ   ‚îî‚îÄ‚îÄ tabs.js                 ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∞–º–∏ (~30 —Å—Ç—Ä–æ–∫)
    ‚îú‚îÄ‚îÄ utils/
    ‚îÇ   ‚îú‚îÄ‚îÄ format.js               ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (~70 —Å—Ç—Ä–æ–∫)
    ‚îÇ   ‚îî‚îÄ‚îÄ dom.js                  ‚úÖ DOM —É—Ç–∏–ª–∏—Ç—ã (~130 —Å—Ç—Ä–æ–∫)
    ‚îî‚îÄ‚îÄ services/
        ‚îî‚îÄ‚îÄ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
```

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### Phase 1.1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (DONE)
- [x] –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ `/public/js/{state,api,ui,services,utils}`
- [x] –°–æ–∑–¥–∞–Ω backup –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ `app.js`

### Phase 1.2: State Management (DONE)
- [x] `AppState.js` - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
  - –ó–∞–º–µ–Ω—è–µ—Ç 22+ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
  - –ì–µ—Ç—Ç–µ—Ä—ã/—Å–µ—Ç—Ç–µ—Ä—ã –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
  - –°–∏–Ω–≥–ª—Ç–æ–Ω –ø–∞—Ç—Ç–µ—Ä–Ω

### Phase 1.3: –£—Ç–∏–ª–∏—Ç—ã (DONE)
- [x] `format.js` - –§—É–Ω–∫—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  - formatFileSize()
  - formatTime()
  - formatTimestamp()
  - formatUptime()
- [x] `dom.js` - DOM —É—Ç–∏–ª–∏—Ç—ã
  - –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
  - –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å DOM

### Phase 1.4: API –°–ª–æ–π (DONE)
- [x] `base-api.js` - –ë–∞–∑–æ–≤—ã–π HTTP –∫–ª–∏–µ–Ω—Ç
  - get(), post(), del(), upload()
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [x] `players-api.js` - API –¥–ª—è –ø–ª–µ–µ—Ä–æ–≤
  - getPlayers(), scanPlayers(), addPlayer()
  - playMedia(), pausePlayer(), stopPlayer()
  - setVolume(), setLoopMode(), playBeep()
- [x] `media-api.js` - API –¥–ª—è –º–µ–¥–∏–∞
  - getMediaFiles(), uploadMediaFile()
  - deleteMediaFile(), getPlaylist()
- [x] `config-api.js` - API –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  - getConfig(), saveSettings()
  - getServerInfo(), getServerStats()

### Phase 1.5: UI –ú–æ–¥—É–ª–∏ (PARTIAL)
- [x] `messages.js` - –°–∏—Å—Ç–µ–º–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
  - addMessage(), clearMessages()
- [x] `tabs.js` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∞–º–∏
  - switchTab()

### Phase 1.6: –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å (DONE)
- [x] `app-main.js` - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
  - –ò–º–ø–æ—Ä—Ç –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
  - –≠–∫—Å–ø–æ—Ä—Ç –≤ window –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å HTML

---

## üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ

### Phase 1.7: –û—Å—Ç–∞–≤—à–∏–µ—Å—è UI –º–æ–¥—É–ª–∏
- [ ] `players-ui.js` - UI —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–ª–µ–µ—Ä–∞–º–∏
- [ ] `media-ui.js` - UI –º–µ–¥–∏–∞ —Ñ–∞–π–ª–æ–≤
- [ ] `status-ui.js` - UI —Å—Ç–∞—Ç—É—Å–æ–≤
- [ ] `groups-ui.js` - UI –≥—Ä—É–ø–ø
- [ ] `settings-ui.js` - UI –Ω–∞—Å—Ç—Ä–æ–µ–∫

### Phase 1.8: –°–µ—Ä–≤–∏—Å—ã
- [ ] `player-service.js` - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø–ª–µ–µ—Ä–æ–≤
- [ ] `refresh-service.js` - –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- [ ] `demo-service.js` - –î–µ–º–æ-—Ä–µ–∂–∏–º

### Phase 1.9: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `app.js` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª–µ–π
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `index.html` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ ES6 –º–æ–¥—É–ª–µ–π
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã

### Phase 2: Backend (server.js)
- [ ] –†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ routes/
- [ ] –°–æ–∑–¥–∞—Ç—å controllers/
- [ ] –í—ã–Ω–µ—Å—Ç–∏ services/ (auto-repeat, stats)
- [ ] –°–æ–∑–¥–∞—Ç—å middleware/

### Phase 3: Storage
- [ ] –†–∞–∑–¥–µ–ª–∏—Ç—å storage.js –Ω–∞ –º–æ–¥—É–ª–∏
- [ ] players.storage.js
- [ ] config.storage.js

### Phase 4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è –∫–æ–¥
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å State Management
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### Phase 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏

### –†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤ (–¥–æ ‚Üí –ø–æ—Å–ª–µ)

| –§–∞–π–ª | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|------|-----|-------|-----------|
| app.js | 2853 —Å—Ç—Ä–æ–∫ | 2853 (legacy) + –º–æ–¥—É–ª–∏ | –†–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ 10+ –º–æ–¥—É–ª–µ–π |
| –°–∞–º—ã–π –±–æ–ª—å—à–æ–π –º–æ–¥—É–ª—å | - | AppState.js (180 —Å—Ç—Ä–æ–∫) | ‚úÖ –£–ø—Ä–∞–≤–ª—è–µ–º–æ |
| –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –º–æ–¥—É–ª—è | - | ~70 —Å—Ç—Ä–æ–∫ | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- ‚úÖ –ö–æ–¥ –ª–µ–≥—á–µ —á–∏—Ç–∞—Ç—å (—Ñ–∞–π–ª—ã <200 —Å—Ç—Ä–æ–∫)
- ‚úÖ –ú–æ–¥—É–ª–∏ –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ (API, utils)
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –õ–µ–≥—á–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:

1. **–†–∞–±–æ—Ç–∞ —Å State:**
```javascript
import { appState } from './js/state/AppState.js';

appState.setPlayers([...]);
const players = appState.getPlayers();
```

2. **–í—ã–∑–æ–≤ API:**
```javascript
import * as PlayersAPI from './js/api/players-api.js';

const players = await PlayersAPI.getPlayers();
await PlayersAPI.playMedia(playerId, fileUrl);
```

3. **UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
```javascript
import { addMessage } from './js/ui/messages.js';

addMessage('–ü–ª–µ–µ—Ä –∑–∞–ø—É—â–µ–Ω', 'success');
```

4. **–£—Ç–∏–ª–∏—Ç—ã:**
```javascript
import { formatFileSize, formatTime } from './js/utils/format.js';

const size = formatFileSize(1024000); // "1 MB"
const time = formatTime(125000); // "02:05"
```

### –î–ª—è HTML (onclick –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏):

–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ `window` –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:
```html
<button onclick="addMessage('–¢–µ—Å—Ç', 'info')">–°–æ–æ–±—â–µ–Ω–∏–µ</button>
<button onclick="switchTab('players', event)">–ü–ª–µ–µ—Ä—ã</button>
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Backup**: –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∫–∞–∫ `app.js.backup`
2. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –ù–æ–≤—ã–µ –º–æ–¥—É–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º
3. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥**: –ú–æ–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ
4. **ES6 Modules**: –¢—Ä–µ–±—É–µ—Ç—Å—è `<script type="module">` –≤ HTML

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `/public/app.js.backup` - –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª
- `/public/js/` - –ù–æ–≤—ã–µ –º–æ–¥—É–ª–∏
- `CLAUDE.md` - –û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- `docs/APP_STRUCTURE.md` - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç–∞—Ä–æ–≥–æ app.js

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –≤–æ–ø—Ä–æ—Å–∞—Ö –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É —Å–º. —ç—Ç–æ—Ç —Ñ–∞–π–ª –∏–ª–∏ CLAUDE.md
