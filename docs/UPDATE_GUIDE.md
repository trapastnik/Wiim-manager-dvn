# üîÑ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é

## –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ Raspberry Pi

### 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Raspberry Pi

```bash
ssh pi@192.168.x.x
cd ~/wiim-web-control  # –∏–ª–∏ –ø—É—Ç—å –∫ –≤–∞—à–µ–º—É –ø—Ä–æ–µ–∫—Ç—É
```

### 2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é .env (–µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è)
cp .env .env.backup

# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–ª–µ–µ—Ä–æ–≤ –∏ –º–µ–¥–∏–∞ (–µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ)
cp -r data data.backup
```

### 3. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–∏—Å (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç systemd)
sudo systemctl stop wiim-control

# –ü–æ–ª—É—á–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
git fetch origin
git pull origin main

# –ò–ª–∏ –µ—Å–ª–∏ –µ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
git stash
git pull origin main
git stash pop
```

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª

```bash
# –°—Ä–∞–≤–Ω–∏—Ç–µ —Å –Ω–æ–≤—ã–º .env.example
diff .env .env.example

# –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –µ—Å–ª–∏ –Ω—É–∂–Ω–æ:
nano .env
```

**–ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏:**
```bash
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π —Ç–∞–π–º–∞—É—Ç (–Ω–æ–≤–æ–µ!)
WIIM_REQUEST_TIMEOUT=5000

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–Ω–æ–≤–æ–µ!)
ENABLE_STATS=false
```

### 5. –û–±–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ package.json
git diff HEAD~1 package.json

# –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
npm install
```

### 6. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ systemd (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
```bash
sudo systemctl start wiim-control
sudo systemctl status wiim-control

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
sudo journalctl -u wiim-control -f
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫**
```bash
npm start
```

### 7. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä
http://192.168.x.x:3000

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –Ω–∞ –æ—à–∏–±–∫–∏
# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
# ‚ö° –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –û–¢–ö–õ–Æ–ß–ï–ù–ê –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
# REQUEST_TIMEOUT: 5000ms
# ENABLE_STATS: false
```

---

## –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–∏—Å
sudo systemctl stop wiim-control

# –í–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∫–æ–º–º–∏—Ç—É
git log --oneline  # –ù–∞–π–¥–∏—Ç–µ –Ω—É–∂–Ω—ã–π –∫–æ–º–º–∏—Ç
git checkout <commit-hash>

# –ò–ª–∏ –æ—Ç–∫–∞—Ç–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç
git reset --hard HEAD~1

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ .env –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
cp .env.backup .env

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
sudo systemctl start wiim-control
```

---

## –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ —ç—Ç–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

### üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

1. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–ª–µ–µ—Ä–æ–≤** (–≤ 7 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!)
   - –ë—ã–ª–æ: ~1400ms –¥–ª—è 7 –ø–ª–µ–µ—Ä–æ–≤
   - –°—Ç–∞–ª–æ: ~200ms –¥–ª—è 7 –ø–ª–µ–µ—Ä–æ–≤

2. **–ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤**
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–±–æ–µ
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ + rename

3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ—Å–ª–µ play**
   - –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É
   - –£—Å–∫–æ—Ä–µ–Ω–∏–µ –≥—Ä—É–ø–ø–æ–≤—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤ –≤ 2 —Ä–∞–∑–∞

### ‚öôÔ∏è –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

4. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π —Ç–∞–π–º–∞—É—Ç**
   - –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —á–µ—Ä–µ–∑ `WIIM_REQUEST_TIMEOUT`
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 7000ms –¥–ª—è Raspberry Pi

5. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞**
   - –ú–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å —á–µ—Ä–µ–∑ `ENABLE_STATS=false`
   - –≠–∫–æ–Ω–æ–º–∏—Ç CPU –∏ –ø–∞–º—è—Ç—å

6. **Debounce –¥–ª—è localStorage**
   - –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤
   - –ó–∞–¥–µ—Ä–∂–∫–∞ 300ms –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º

### üõ°Ô∏è –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å

7. **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤**
   - –£–¥–∞–ª—è–µ—Ç .tmp —Ñ–∞–π–ª—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
   - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –º—É—Å–æ—Ä–∞

8. **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ Node.js 18+**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ package.json
   - npm –ø—Ä–æ–≤–µ—Ä–∏—Ç –≤–µ—Ä—Å–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

9. **–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è Raspberry Pi**
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ systemd
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â–∏–π –∫–æ–º–º–∏—Ç
git log -1 --oneline

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é –≤ package.json
cat package.json | grep version

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç
cat .env | grep TIMEOUT
cat .env | grep STATS
```

---

## –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

### –ü—Ä–æ–±–ª–µ–º–∞: Git –∫–æ–Ω—Ñ–ª–∏–∫—Ç –≤ .env

```bash
# .env –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ git, –Ω–æ –µ—Å–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç:
git checkout --theirs .env
# –ò–ª–∏:
git checkout --ours .env
# –ó–∞—Ç–µ–º –≤—Ä—É—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

### –ü—Ä–æ–±–ª–µ–º–∞: npm install –æ—à–∏–±–∫–∞

```bash
# –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à
npm cache clean --force
rm -rf node_modules package-lock.json
npm install
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
sudo journalctl -u wiim-control -n 50

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
node --check server.js

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é Node.js
node --version  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å >= 18.0.0
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Ç–µ—Ä—è–ª–∏—Å—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–µ–µ—Ä–æ–≤

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ backup
cp data.backup/players.json data/
cp data.backup/media.json data/

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
sudo systemctl restart wiim-control
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (—Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –¥–∞—É–Ω—Ç–∞–π–º–æ–º)

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
curl http://localhost:3000/api/players

# 2. –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
git pull && npm install && sudo systemctl restart wiim-control

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ (–¥–æ–ª–∂–Ω–æ –∑–∞–Ω—è—Ç—å ~5-10 —Å–µ–∫—É–Ω–¥)
sleep 5
curl http://localhost:3000/api/players

# –ï—Å–ª–∏ –≤—Å–µ –û–ö - –≥–æ—Ç–æ–≤–æ!
```

---

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö)

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `update.sh`:

```bash
#!/bin/bash
set -e

echo "üîÑ Updating WiiM Control..."

# Backup
echo "üì¶ Creating backup..."
cp .env .env.backup.$(date +%Y%m%d_%H%M%S)

# Stop service
echo "‚è∏Ô∏è  Stopping service..."
sudo systemctl stop wiim-control

# Update code
echo "‚¨áÔ∏è  Pulling updates..."
git pull origin main

# Install dependencies
echo "üìö Installing dependencies..."
npm install

# Start service
echo "‚ñ∂Ô∏è  Starting service..."
sudo systemctl start wiim-control

# Wait and check
echo "‚è≥ Waiting for service..."
sleep 5

if sudo systemctl is-active --quiet wiim-control; then
    echo "‚úÖ Update successful!"
    echo "üìä Service status:"
    sudo systemctl status wiim-control --no-pager -l
else
    echo "‚ùå Update failed! Rolling back..."
    git reset --hard HEAD~1
    sudo systemctl start wiim-control
    exit 1
fi
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```bash
chmod +x update.sh
./update.sh
```

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
htop

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
sudo journalctl -u wiim-control -f

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞
time curl http://localhost:3000/api/players

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –ø–ª–µ–µ—Ä–æ–≤
# (–∑–∞–ø—É—Å—Ç–∏—Ç–µ –≥—Ä—É–ø–ø—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
```

---

## –°–≤—è–∑—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å–æ–±–µ—Ä–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
{
    echo "=== System Info ==="
    uname -a
    echo ""
    echo "=== Node.js Version ==="
    node --version
    echo ""
    echo "=== Service Status ==="
    sudo systemctl status wiim-control --no-pager
    echo ""
    echo "=== Last 50 Log Lines ==="
    sudo journalctl -u wiim-control -n 50 --no-pager
    echo ""
    echo "=== Git Status ==="
    git log -1
    git status
} > diagnostics.txt

# –û—Ç–ø—Ä–∞–≤—å—Ç–µ diagnostics.txt
```
