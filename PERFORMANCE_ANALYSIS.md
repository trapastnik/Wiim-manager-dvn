# ÐÐ½Ð°Ð»Ð¸Ð· Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€ Ð¸ Wi-Fi Ñ‚Ñ€Ð°Ñ„Ð¸Ðº

## Ð”Ð°Ñ‚Ð° Ð°Ð½Ð°Ð»Ð¸Ð·Ð°: 2025-12-21

---

## ðŸ“Š Ð¢Ð•ÐšÐ£Ð©ÐÐ¯ ÐÐÐ“Ð Ð£Ð—ÐšÐ

### 1. ÐÐ²Ñ‚Ð¾Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑÐ¾Ð² (Adaptive Refresh)

**Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº:** `refresh-service.js:12-35`

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:**
- ÐŸÑ€Ð¸ **Ð²Ð¾ÑÐ¿Ñ€Ð¾Ð¸Ð·Ð²ÐµÐ´ÐµÐ½Ð¸Ð¸**: Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÐºÐ°Ð¶Ð´Ñ‹Ðµ **2 ÑÐµÐºÑƒÐ½Ð´Ñ‹**
- Ð’ **Ñ€ÐµÐ¶Ð¸Ð¼Ðµ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ**: Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÐºÐ°Ð¶Ð´Ñ‹Ðµ **10 ÑÐµÐºÑƒÐ½Ð´**
- Ð—Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ðº ÐºÐ°Ð¶Ð´Ð¾Ð¼Ñƒ Ð¿Ð»ÐµÐµÑ€Ñƒ: `GET /api/players/:ip/status`

#### Ð Ð°ÑÑ‡Ñ‘Ñ‚ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸:

**Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 1: ÐžÐ´Ð¸Ð½ Ð¿Ð»ÐµÐµÑ€ Ð¸Ð³Ñ€Ð°ÐµÑ‚**
- Ð—Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð² Ð¼Ð¸Ð½ÑƒÑ‚Ñƒ: 30 (60 / 2)
- Ð—Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð² Ñ‡Ð°Ñ: 1,800
- Ð—Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð² Ð´ÐµÐ½ÑŒ: 43,200

**Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 2: ÐŸÑÑ‚ÑŒ Ð¿Ð»ÐµÐµÑ€Ð¾Ð² Ð¸Ð³Ñ€Ð°ÑŽÑ‚**
- Ð—Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð² Ð¼Ð¸Ð½ÑƒÑ‚Ñƒ: 150 (5 Ã— 30)
- Ð—Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð² Ñ‡Ð°Ñ: 9,000
- Ð—Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð² Ð´ÐµÐ½ÑŒ: 216,000

**Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 3: Ð”ÐµÑÑÑ‚ÑŒ Ð¿Ð»ÐµÐµÑ€Ð¾Ð² Ð² Ñ€ÐµÐ¶Ð¸Ð¼Ðµ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ**
- Ð—Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð² Ð¼Ð¸Ð½ÑƒÑ‚Ñƒ: 10 (10 Ã— 6)
- Ð—Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð² Ñ‡Ð°Ñ: 600
- Ð—Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð² Ð´ÐµÐ½ÑŒ: 14,400

---

### 2. Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ (Config Sync)

**Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº:** `config-sync.service.js`

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:**
- **Debounce:** 300ms (0.3 ÑÐµÐº)
- **Ð¢Ð¸Ð¿Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…:**
  - Player Selections
  - Loop Modes
  - Player Volumes
  - Player Groups

**ÐÐ°Ð³Ñ€ÑƒÐ·ÐºÐ°:**
- âœ… **ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð°Ñ** - ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸ÑÑ…
- âœ… **ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾** - debounce Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð¸Ð·Ð±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹
- ÐŸÑ€Ð¸Ð¼ÐµÑ€: Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð³Ñ€Ð¾Ð¼ÐºÐ¾ÑÑ‚Ð¸ Ð¿Ð¾Ð»Ð·ÑƒÐ½ÐºÐ¾Ð¼ â†’ 1 Ð·Ð°Ð¿Ñ€Ð¾Ñ Ñ‡ÐµÑ€ÐµÐ· 300ms

---

### 3. Loop Mode ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°

**Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº:** `player-service.js`, `loop-mode.service.js`

**ÐšÐ¾Ð³Ð´Ð° Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚:**
- ÐŸÑ€Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐµ Ð²Ð¾ÑÐ¿Ñ€Ð¾Ð¸Ð·Ð²ÐµÐ´ÐµÐ½Ð¸Ñ (playPlayer, playAll, playGroup)
- ÐŸÑ€Ð¸ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¸ Native Loop Ð´Ð»Ñ Ð²ÑÐµÑ… Ð¿Ð»ÐµÐµÑ€Ð¾Ð²

**ÐÐ°Ð³Ñ€ÑƒÐ·ÐºÐ°:**
```
playPlayer(1 Ð¿Ð»ÐµÐµÑ€):
  1. POST /api/players/:ip/loop (ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° loop mode)
  2. POST /api/players/:ip/play (Ð·Ð°Ð¿ÑƒÑÐº Ð²Ð¾ÑÐ¿Ñ€Ð¾Ð¸Ð·Ð²ÐµÐ´ÐµÐ½Ð¸Ñ)
  = 2 Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°

playAll(5 Ð¿Ð»ÐµÐµÑ€Ð¾Ð²):
  1. 5 Ã— POST /api/players/:ip/loop
  2. 5 Ã— POST /api/players/:ip/play
  = 10 Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ð¾

toggleNativeLoop(5 Ð¿Ð»ÐµÐµÑ€Ð¾Ð²):
  5 Ã— POST /api/players/:ip/loop
  = 5 Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ð¾
```

---

## ðŸŒ WI-FI Ð¢Ð ÐÐ¤Ð˜Ðš

### ÐžÑ†ÐµÐ½ÐºÐ° Ñ€Ð°Ð·Ð¼ÐµÑ€Ð¾Ð² Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²/Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²:

**HTTP Request Ðº WiiM ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ñƒ:**
```
GET /httpapi.asp?command=getPlayerStatus HTTP/1.1
Host: 192.168.1.100
Connection: keep-alive

Ð Ð°Ð·Ð¼ÐµÑ€: ~120 Ð±Ð°Ð¹Ñ‚
```

**HTTP Response Ð¾Ñ‚ WiiM ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°:**
```json
{
  "status": "play",
  "vol": 50,
  "curpos": 45000,
  "totlen": 180000,
  "ssid": "MyWiFi",
  "rssi": -45,
  "title": "Song Name",
  "artist": "Artist Name"
}

Ð Ð°Ð·Ð¼ÐµÑ€: ~200-500 Ð±Ð°Ð¹Ñ‚ (Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ñ…)
```

**Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ñ€Ð°Ð·Ð¼ÐµÑ€ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ñ†Ð¸ÐºÐ»Ð° Ð·Ð°Ð¿Ñ€Ð¾Ñ/Ð¾Ñ‚Ð²ÐµÑ‚:** ~500 Ð±Ð°Ð¹Ñ‚

### Ð Ð°ÑÑ‡Ñ‘Ñ‚ Ñ‚Ñ€Ð°Ñ„Ð¸ÐºÐ°:

**Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹: 5 Ð¿Ð»ÐµÐµÑ€Ð¾Ð² Ð¸Ð³Ñ€Ð°ÑŽÑ‚ (2 ÑÐµÐº Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»)**

**Ð’ Ð¼Ð¸Ð½ÑƒÑ‚Ñƒ:**
- Ð—Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²: 150
- Ð¢Ñ€Ð°Ñ„Ð¸Ðº: 150 Ã— 500 Ð±Ð°Ð¹Ñ‚ = **75 KB**

**Ð’ Ñ‡Ð°Ñ:**
- Ð—Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²: 9,000
- Ð¢Ñ€Ð°Ñ„Ð¸Ðº: 9,000 Ã— 500 Ð±Ð°Ð¹Ñ‚ = **4.5 MB**

**Ð’ Ð´ÐµÐ½ÑŒ (10 Ñ‡Ð°ÑÐ¾Ð² Ð¿Ñ€Ð¾ÑÐ»ÑƒÑˆÐ¸Ð²Ð°Ð½Ð¸Ñ):**
- Ð¢Ñ€Ð°Ñ„Ð¸Ðº: **45 MB**

### Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ñ‚Ñ€Ð°Ñ„Ð¸Ðº:

**ÐÑƒÐ´Ð¸Ð¾ ÑÑ‚Ñ€Ð¸Ð¼ (Ð¾Ñ‚ ÑÐµÑ€Ð²ÐµÑ€Ð° Ðº WiiM):**
- Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚: MP3/FLAC (Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ Ñ„Ð°Ð¹Ð»Ð°)
- Ð‘Ð¸Ñ‚Ñ€ÐµÐ¹Ñ‚: 320 kbps (MP3) Ð¸Ð»Ð¸ 1411 kbps (FLAC)
- Ð¢Ñ€Ð°Ñ„Ð¸Ðº Ð² Ñ‡Ð°Ñ:
  - MP3: ~140 MB/Ñ‡Ð°Ñ Ð½Ð° Ð¿Ð»ÐµÐµÑ€
  - FLAC: ~620 MB/Ñ‡Ð°Ñ Ð½Ð° Ð¿Ð»ÐµÐµÑ€

**Ð”Ð»Ñ 5 Ð¿Ð»ÐµÐµÑ€Ð¾Ð² (MP3, 10 Ñ‡Ð°ÑÐ¾Ð²):**
- ÐÑƒÐ´Ð¸Ð¾: 5 Ã— 140 MB Ã— 10 = **7,000 MB (7 GB)**
- Polling: **45 MB**
- **Ð˜Ñ‚Ð¾Ð³Ð¾: ~7 GB Ð² Ð´ÐµÐ½ÑŒ**

---

## âš ï¸ ÐŸÐ ÐžÐ‘Ð›Ð•ÐœÐÐ«Ð• Ð—ÐžÐÐ«

### ðŸ”´ ÐšÐ Ð˜Ð¢Ð˜Ð§ÐÐž: Ð§Ð°ÑÑ‚Ð¾Ñ‚Ð° Ð¾Ð¿Ñ€Ð¾ÑÐ° Ð¿Ñ€Ð¸ Ð²Ð¾ÑÐ¿Ñ€Ð¾Ð¸Ð·Ð²ÐµÐ´ÐµÐ½Ð¸Ð¸

**ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°:**
- Ð˜Ð½Ñ‚ÐµÑ€Ð²Ð°Ð» **2 ÑÐµÐºÑƒÐ½Ð´Ñ‹** - Ð¾Ñ‡ÐµÐ½ÑŒ Ð°Ð³Ñ€ÐµÑÑÐ¸Ð²Ð½Ð¾
- ÐŸÑ€Ð¸ 10+ Ð¿Ð»ÐµÐµÑ€Ð°Ñ… ÑÐ¾Ð·Ð´Ð°Ñ‘Ñ‚ **300+ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð² Ð¼Ð¸Ð½ÑƒÑ‚Ñƒ**

**Ð’Ð»Ð¸ÑÐ½Ð¸Ðµ:**
- ÐÐ°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð½Ð° Node.js ÑÐµÑ€Ð²ÐµÑ€ (CPU, ÑÐµÑ‚ÐµÐ²Ñ‹Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ)
- ÐÐ°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð½Ð° Wi-Fi ÑÐµÑ‚ÑŒ (Ð¼Ð½Ð¾Ð³Ð¾Ñ‡Ð¸ÑÐ»ÐµÐ½Ð½Ñ‹Ðµ Ð¼ÐµÐ»ÐºÐ¸Ðµ Ð¿Ð°ÐºÐµÑ‚Ñ‹)
- ÐŸÐ¾Ñ‚ÐµÐ½Ñ†Ð¸Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð·Ð°Ð¼ÐµÐ´Ð»ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ÐºÐ»Ð¸ÐºÐ° ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð² WiiM

**Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ñ:**
- Ð£Ð²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð» Ð´Ð¾ **5 ÑÐµÐºÑƒÐ½Ð´** Ð¿Ñ€Ð¸ Ð²Ð¾ÑÐ¿Ñ€Ð¾Ð¸Ð·Ð²ÐµÐ´ÐµÐ½Ð¸Ð¸
- Ð¡Ð½Ð¸Ð·Ð¸Ñ‚ÑŒ Ð´Ð¾ **15-20 ÑÐµÐºÑƒÐ½Ð´** Ð² Ñ€ÐµÐ¶Ð¸Ð¼Ðµ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ

### ðŸŸ¡ Ð¡Ð Ð•Ð”ÐÐ¯Ð¯: ÐŸÐ°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ðº Ð¾Ð´Ð½Ð¾Ð¼Ñƒ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ñƒ

**ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð°:**
- ÐŸÑ€Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐµ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ Ð¿Ð»ÐµÐµÑ€Ð¾Ð² Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ÑÑ 2 Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ðº ÐºÐ°Ð¶Ð´Ð¾Ð¼Ñƒ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ñƒ ÑÑ€Ð°Ð·Ñƒ:
  1. setLoopMode
  2. playMedia

**Ð’Ð»Ð¸ÑÐ½Ð¸Ðµ:**
- Ð£ÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð¾ WiiM Ð¼Ð¾Ð¶ÐµÑ‚ Ð½Ðµ ÑƒÑÐ¿ÐµÑ‚ÑŒ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ Ð¿ÐµÑ€Ð²ÑƒÑŽ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ
- Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹ race conditions

**Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ñ:**
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ (await Ð¼ÐµÐ¶Ð´Ñƒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°Ð¼Ð¸)
- Ð˜Ð»Ð¸ Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½Ð¸Ñ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð² Ð¾Ð´Ð¸Ð½ Ð·Ð°Ð¿Ñ€Ð¾Ñ

### ðŸŸ¢ ÐÐ˜Ð—ÐšÐÐ¯: Config Sync debounce

**Ð¡Ñ‚Ð°Ñ‚ÑƒÑ:** âœ… Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾
- Debounce 300ms Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð¸Ð·Ð±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹
- Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸ÑÑ…

---

## ðŸ’¡ Ð Ð•ÐšÐžÐœÐ•ÐÐ”ÐÐ¦Ð˜Ð˜ ÐŸÐž ÐžÐŸÐ¢Ð˜ÐœÐ˜Ð—ÐÐ¦Ð˜Ð˜

### 1. Ð£Ð²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ñ‹ Ð°Ð²Ñ‚Ð¾Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ

**Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð² `refresh-service.js:29`:**

```javascript
// Ð‘Ð«Ð›Ðž:
const interval = isPlaying ? 2000 : 10000;

// Ð Ð•ÐšÐžÐœÐ•ÐÐ”Ð£Ð•Ð¢Ð¡Ð¯:
const interval = isPlaying ? 5000 : 20000;
```

**Ð­Ñ„Ñ„ÐµÐºÑ‚:**
- Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð² **2.5 Ñ€Ð°Ð·Ð°** Ð¿Ñ€Ð¸ Ð²Ð¾ÑÐ¿Ñ€Ð¾Ð¸Ð·Ð²ÐµÐ´ÐµÐ½Ð¸Ð¸
- Ð”Ð»Ñ 5 Ð¿Ð»ÐµÐµÑ€Ð¾Ð²: 9,000 â†’ 3,600 Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð² Ñ‡Ð°Ñ

### 2. Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ñ‹

**Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð² AppState:**

```javascript
refreshIntervals = {
  playing: 5000,      // 5 ÑÐµÐº Ð¿Ñ€Ð¸ Ð²Ð¾ÑÐ¿Ñ€Ð¾Ð¸Ð·Ð²ÐµÐ´ÐµÐ½Ð¸Ð¸
  idle: 20000,        // 20 ÑÐµÐº Ð² Ñ€ÐµÐ¶Ð¸Ð¼Ðµ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ
  aggressive: 2000,   // 2 ÑÐµÐº Ð´Ð»Ñ "Ð°Ð³Ñ€ÐµÑÑÐ¸Ð²Ð½Ð¾Ð³Ð¾" Ñ€ÐµÐ¶Ð¸Ð¼Ð° (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)
}
```

**UI Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð² Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ð¾Ð¼ Ñ€ÐµÐ¶Ð¸Ð¼Ðµ:**
- ÐŸÐ¾Ð·Ð²Ð¾Ð»Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ñ€ÐµÐ¶Ð¸Ð¼: "Ð­ÐºÐ¾Ð½Ð¾Ð¼Ð½Ñ‹Ð¹" / "Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð½Ñ‹Ð¹" / "Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹"

### 3. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ WebSocket Ð²Ð¼ÐµÑÑ‚Ð¾ polling

**ÐšÐ¾Ð½Ñ†ÐµÐ¿Ñ†Ð¸Ñ:**
- Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ WebSocket ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ñ ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð¼
- Ð¡ÐµÑ€Ð²ÐµÑ€ Ð¾Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÑ‚ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð° Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð¿Ð¾ WebSocket
- ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð±ÐµÐ· polling

**ÐŸÑ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð°:**
- Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð½Ð° ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° (Ð½ÐµÑ‚ Ð¸ÑÑ…Ð¾Ð´ÑÑ‰Ð¸Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²)
- Ð‘Ð¾Ð»ÐµÐµ Ð±Ñ‹ÑÑ‚Ñ€Ñ‹Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ
- ÐœÐµÐ½ÑŒÑˆÐµ Wi-Fi Ñ‚Ñ€Ð°Ñ„Ð¸ÐºÐ°

**ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ¸:**
- Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ Ñ€ÐµÑ„Ð°ÐºÑ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° ÑÐµÑ€Ð²ÐµÑ€Ð°
- Ð¡Ð»Ð¾Ð¶Ð½ÐµÐµ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ

### 4. ÐšÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑÐ¾Ð² Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ

**ÐšÐ¾Ð½Ñ†ÐµÐ¿Ñ†Ð¸Ñ:**
- Ð¡ÐµÑ€Ð²ÐµÑ€ ÐºÑÑˆÐ¸Ñ€ÑƒÐµÑ‚ ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹ Ð¿Ð»ÐµÐµÑ€Ð¾Ð² Ð½Ð° N ÑÐµÐºÑƒÐ½Ð´
- ÐšÐ»Ð¸ÐµÐ½Ñ‚ÑÐºÐ¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÑŽÑ‚ ÐºÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
- Ð¡ÐµÑ€Ð²ÐµÑ€ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ ÐºÑÑˆ Ð² Ñ„Ð¾Ð½Ðµ

**ÐŸÑ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð°:**
- Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð½Ð° WiiM ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°
- Ð‘Ñ‹ÑÑ‚Ñ€ÐµÐµ Ð¾Ñ‚ÐºÐ»Ð¸Ðº Ð´Ð»Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°

### 5. Batching Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²

**ÐšÐ¾Ð½Ñ†ÐµÐ¿Ñ†Ð¸Ñ:**
- Ð’Ð¼ÐµÑÑ‚Ð¾ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ðº ÐºÐ°Ð¶Ð´Ð¾Ð¼Ñƒ Ð¿Ð»ÐµÐµÑ€Ñƒ
- ÐžÐ´Ð¸Ð½ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€: `GET /api/players/statuses`
- Ð¡ÐµÑ€Ð²ÐµÑ€ Ð¾Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÑ‚ Ð²ÑÐµ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð° Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð°Ð³Ñ€ÐµÐ³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚

**ÐŸÑ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð°:**
- ÐœÐµÐ½ÑŒÑˆÐµ HTTP overhead
- ÐŸÑ€Ð¾Ñ‰Ðµ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ

### 6. Ð£Ð¼Ð½Ñ‹Ð¹ polling (Smart Polling)

**ÐšÐ¾Ð½Ñ†ÐµÐ¿Ñ†Ð¸Ñ:**
- ÐžÑ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ñ‚ÑŒ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
- Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½ÐµÐ°ÐºÑ‚Ð¸Ð²ÐµÐ½ 5 Ð¼Ð¸Ð½ÑƒÑ‚ â†’ ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð» Ð´Ð¾ 60 ÑÐµÐº
- ÐŸÑ€Ð¸ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸ â†’ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ Ðº Ð½Ð¾Ñ€Ð¼Ðµ

**Ð ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ:**
```javascript
let userLastActivity = Date.now();

document.addEventListener('click', () => {
  userLastActivity = Date.now();
});

// Ð’ checkAndRefresh:
const isUserActive = (Date.now() - userLastActivity) < 300000; // 5 Ð¼Ð¸Ð½
const interval = isUserActive
  ? (isPlaying ? 5000 : 20000)
  : 60000; // 1 Ð¼Ð¸Ð½ÑƒÑ‚Ð° ÐµÑÐ»Ð¸ Ð½ÐµÐ°ÐºÑ‚Ð¸Ð²ÐµÐ½
```

---

## ðŸ“ˆ Ð¡Ð ÐÐ’ÐÐ•ÐÐ˜Ð•: Ð”Ð¾ Ð¸ ÐŸÐ¾ÑÐ»Ðµ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ð¸

### âš ï¸ Ð”Ðž Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ð¸ (5 Ð¿Ð»ÐµÐµÑ€Ð¾Ð², 10 Ñ‡Ð°ÑÐ¾Ð²):

| ÐœÐµÑ‚Ñ€Ð¸ÐºÐ° | Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ |
|---------|----------|
| Ð—Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð² Ñ‡Ð°Ñ | 9,000 |
| Polling Ñ‚Ñ€Ð°Ñ„Ð¸Ðº Ð² Ð´ÐµÐ½ÑŒ | 45 MB |
| ÐžÐ±Ñ‰Ð¸Ð¹ Wi-Fi Ñ‚Ñ€Ð°Ñ„Ð¸Ðº | ~7 GB |

### âœ… ÐŸÐžÐ¡Ð›Ð• Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ð¸ (Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð» 5/20 ÑÐµÐº) - **ÐŸÐ Ð˜ÐœÐ•ÐÐ•ÐÐž**:

| ÐœÐµÑ‚Ñ€Ð¸ÐºÐ° | Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ | Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ |
|---------|----------|-----------|
| Ð—Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð² Ñ‡Ð°Ñ | 3,600 | â†“ 60% |
| Polling Ñ‚Ñ€Ð°Ñ„Ð¸Ðº Ð² Ð´ÐµÐ½ÑŒ | 18 MB | â†“ 60% |
| ÐžÐ±Ñ‰Ð¸Ð¹ Wi-Fi Ñ‚Ñ€Ð°Ñ„Ð¸Ðº | ~7 GB | Ð±ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ |

### Ð¡ WebSocket:

| ÐœÐµÑ‚Ñ€Ð¸ÐºÐ° | Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ | Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ |
|---------|----------|-----------|
| Ð—Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð¾Ñ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° | 0 | â†“ 100% |
| Polling Ñ‚Ñ€Ð°Ñ„Ð¸Ðº | Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ | â†“ 95% |
| ÐžÐ±Ñ‰Ð¸Ð¹ Wi-Fi Ñ‚Ñ€Ð°Ñ„Ð¸Ðº | ~7 GB | Ð±ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ |

---

## ðŸŽ¯ ÐŸÐ Ð˜ÐžÐ Ð˜Ð¢Ð•Ð¢Ð« ÐžÐŸÐ¢Ð˜ÐœÐ˜Ð—ÐÐ¦Ð˜Ð˜

### âœ… Ð’Ñ‹ÑÐ¾ÐºÐ¸Ð¹ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ (ÐŸÐ Ð˜ÐœÐ•ÐÐ•ÐÐž):
1. âœ… **Ð£Ð²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ñ‹** (5 ÑÐµÐº / 20 ÑÐµÐº) - **Ð“ÐžÐ¢ÐžÐ’Ðž**

### Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ (ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ):
2. Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ (ÑƒÐ¼Ð½Ñ‹Ð¹ polling)
3. Batching Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² (Ð¾Ð´Ð¸Ð½ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð½Ð° Ð²ÑÐµ ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹)
4. ÐšÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ
5. ÐÐ°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ñ‹ Ð² UI

### ÐÐ¸Ð·ÐºÐ¸Ð¹ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ (Ð´Ð»Ñ Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ):
6. WebSocket Ð²Ð¼ÐµÑÑ‚Ð¾ polling
7. Server-Sent Events (SSE)

---

## ðŸ”§ ÐŸÐ Ð˜ÐœÐ•ÐÐÐÐÐ«Ð• Ð Ð•Ð¨Ð•ÐÐ˜Ð¯

### âœ… Ð¤Ð¸ÐºÑ #1: Ð£Ð²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð»Ð¾Ð² - ÐŸÐ Ð˜ÐœÐ•ÐÐ•ÐÐž

**Ð¤Ð°Ð¹Ð»:** `public/js/services/refresh-service.js:29`

```javascript
// Ð‘Ð«Ð›Ðž:
const interval = isPlaying ? 2000 : 10000;

// Ð¡Ð¢ÐÐ›Ðž:
const interval = isPlaying ? 5000 : 20000;
```

**Ð­Ñ„Ñ„ÐµÐºÑ‚:** Ð¡Ð½Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð½Ð° 60%

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:**
- 9,000 â†’ 3,600 Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²/Ñ‡Ð°Ñ (5 Ð¿Ð»ÐµÐµÑ€Ð¾Ð²)
- 45 MB â†’ 18 MB polling Ñ‚Ñ€Ð°Ñ„Ð¸ÐºÐ°/Ð´ÐµÐ½ÑŒ

---

## ðŸ“ Ð’Ð«Ð’ÐžÐ”Ð«

### âœ… Ð§Ñ‚Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾:
- Config Sync Ñ debounce 300ms
- ÐŸÐ°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ñ‡ÐµÑ€ÐµÐ· Promise.all
- ÐÐ´Ð°Ð¿Ñ‚Ð¸Ð²Ð½Ð¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ (playing vs idle)

### âœ… ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾:
- âœ… **Ð§Ð°ÑÑ‚Ð¾Ñ‚Ð° Ð¾Ð¿Ñ€Ð¾ÑÐ°** - ÑƒÐ²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð° Ñ 2/10 ÑÐµÐº Ð´Ð¾ 5/20 ÑÐµÐº (ÑÐ½Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð½Ð° 60%)

### ðŸ’¡ Ð”Ð°Ð»ÑŒÐ½ÐµÐ¹ÑˆÐ¸Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ð¸:
- Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ (ÑƒÐ¼Ð½Ñ‹Ð¹ polling)
- Batching Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² (Ð¾Ð´Ð¸Ð½ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð½Ð° Ð²ÑÐµ ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹)
- ÐšÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ
- Ð’ Ð±ÑƒÐ´ÑƒÑ‰ÐµÐ¼: Ñ€Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ WebSocket Ð´Ð»Ñ Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ

---

*ÐÐ½Ð°Ð»Ð¸Ð· Ð¿Ñ€Ð¾Ð²ÐµÐ´Ñ‘Ð½: 2025-12-21*
*Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ: full_refactor*
