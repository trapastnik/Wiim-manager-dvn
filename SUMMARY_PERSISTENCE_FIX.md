# ‚úÖ –°–û–•–†–ê–ù–ï–ù–ò–ï –î–ê–ù–ù–´–• - –ò–°–ü–†–ê–í–õ–ï–ù–û

**–î–∞—Ç–∞:** 2025-12-21
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ

---

## üéØ –ü–†–û–ë–õ–ï–ú–ê

Frontend –ø—ã—Ç–∞–ª—Å—è —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ 6 API endpoints, –∫–æ—Ç–æ—Ä—ã–µ **–ù–ï –°–£–©–ï–°–¢–í–û–í–ê–õ–ò** –Ω–∞ backend:

```
POST /api/config/sync             ‚Üí 404 Not Found ‚ùå
POST /api/config/loop-modes        ‚Üí 404 Not Found ‚ùå
POST /api/config/settings          ‚Üí 404 Not Found ‚ùå
POST /api/config/panel-width       ‚Üí 404 Not Found ‚ùå
POST /api/config/loop-experimental ‚Üí 404 Not Found ‚ùå
POST /api/config/cleanup           ‚Üí 404 Not Found ‚ùå
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- ‚ùå Loop modes —Ç–µ—Ä—è–ª–∏—Å—å –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
- ‚ùå –í—ã–±–æ—Ä —Ç—Ä–µ–∫–æ–≤ –¥–ª—è –ø–ª–µ–µ—Ä–æ–≤ —Ç–µ—Ä—è–ª—Å—è
- ‚ùå –ì—Ä—É–ø–ø—ã –ø–ª–µ–µ—Ä–æ–≤ —Ç–µ—Ä—è–ª–∏—Å—å
- ‚ùå –ì—Ä–æ–º–∫–æ—Å—Ç–∏ —Ç–µ—Ä—è–ª–∏—Å—å
- ‚ùå –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ç–µ—Ä—è–ª–∏—Å—å

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï

–î–æ–±–∞–≤–ª–µ–Ω—ã **161 —Å—Ç—Ä–æ–∫–∞ –∫–æ–¥–∞** –≤ 3 —Ñ–∞–π–ª–∞:

### 1. storage.js (+46 —Å—Ç—Ä–æ–∫)
- `getConfig()` - –ø–æ–ª—É—á–∏—Ç—å –≤—Å—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- `saveConfig()` - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

### 2. src/routes/config.routes.js (+29 —Å—Ç—Ä–æ–∫)
–î–æ–±–∞–≤–ª–µ–Ω–æ 6 endpoints:
- `POST /api/config/sync` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è playerSelections, groups, volumes
- `POST /api/config/loop-modes` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ loop modes
- `POST /api/config/settings` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- `POST /api/config/panel-width` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã –ø–∞–Ω–µ–ª–∏
- `POST /api/config/loop-experimental` - —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `POST /api/config/cleanup` - –æ—á–∏—Å—Ç–∫–∞ –±–∏—Ç—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

### 3. src/controllers/config.controller.js (+86 —Å—Ç—Ä–æ–∫)
–î–æ–±–∞–≤–ª–µ–Ω–æ 6 –º–µ—Ç–æ–¥–æ–≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:
- `syncConfig()` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `saveLoopModes()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ loop modes
- `saveSettings()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- `savePanelWidth()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã –ø–∞–Ω–µ–ª–∏
- `saveLoopExperimentalSettings()` - —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `cleanupBrokenStates()` - –æ—á–∏—Å—Ç–∫–∞ –±–∏—Ç—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢

| –î–∞–Ω–Ω—ã–µ | –î–æ | –ü–æ—Å–ª–µ |
|--------|-----|-------|
| –ü–ª–µ–µ—Ä—ã | ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å | ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è |
| –ú–µ–¥–∏–∞ —Ñ–∞–π–ª—ã | ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å | ‚úÖ –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è |
| **–í—ã–±–æ—Ä —Ç—Ä–µ–∫–æ–≤** | ‚ùå **–¢–µ—Ä—è–ª–∏—Å—å** | ‚úÖ **–°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** |
| **–ì—Ä—É–ø–ø—ã –ø–ª–µ–µ—Ä–æ–≤** | ‚ùå **–¢–µ—Ä—è–ª–∏—Å—å** | ‚úÖ **–°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** |
| **Loop modes** | ‚ùå **–¢–µ—Ä—è–ª–∏—Å—å** | ‚úÖ **–°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** |
| **–ì—Ä–æ–º–∫–æ—Å—Ç–∏** | ‚ùå **–¢–µ—Ä—è–ª–∏—Å—å** | ‚úÖ **–°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** |
| **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** | ‚ùå **–¢–µ—Ä—è–ª–∏—Å—å** | ‚úÖ **–°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** |

---

## üóÇÔ∏è –ì–î–ï –•–†–ê–ù–Ø–¢–°–Ø –î–ê–ù–ù–´–ï

### data/players.json
```json
{
  "players": [
    {
      "id": "player-1",
      "ip": "192.168.1.100",
      "name": "WiiM Mini",
      "addedAt": "2025-12-21T10:00:00.000Z"
    }
  ]
}
```

### data/media.json
```json
{
  "files": [
    {
      "id": "file-1",
      "filename": "track.mp3",
      "url": "/media/track.mp3",
      "addedAt": "2025-12-21T10:00:00.000Z"
    }
  ],
  "playlists": []
}
```

### data/playback-state.json ‚úÖ –¢–ï–ü–ï–†–¨ –†–ê–ë–û–¢–ê–ï–¢
```json
{
  "playerSelections": {
    "player-1": "/media/track.mp3"
  },
  "playerGroups": [
    {
      "id": "group-1",
      "name": "–ì—Ä—É–ø–ø–∞ 1",
      "playerIds": ["player-1", "player-2"]
    }
  ],
  "lastUpdated": "2025-12-21T10:00:00.000Z"
}
```

### data/ui-config.json ‚úÖ –¢–ï–ü–ï–†–¨ –†–ê–ë–û–¢–ê–ï–¢
```json
{
  "playerLoopModes": {
    "player-1": 2,
    "player-2": 0
  },
  "playerVolumes": {
    "player-1": 75,
    "player-2": 50
  },
  "appSettings": {
    "beepSoundUrl": "default"
  },
  "messagesPanelWidth": 400,
  "loopExperimentalSettings": {
    "useWiimNativeLoop": true,
    "useClientMonitoring": false
  },
  "lastUpdated": "2025-12-21T10:00:00.000Z"
}
```

---

## üîí –ó–ê–©–ò–¢–ê –î–ê–ù–ù–´–•

### 1. Debounce 300ms
```javascript
// public/js/services/config-sync.service.js
// –ù–µ –±–æ–ª–µ–µ 1 –∑–∞–ø—Ä–æ—Å–∞ –≤ 300ms
saveSelectionsTimer = setTimeout(async () => {
  await ConfigAPI.syncConfig({ playerSelections });
}, 300);
```

### 2. –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å
```javascript
// storage.js
// –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å—å –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª, –∑–∞—Ç–µ–º rename
writeFileSync(tempFile, JSON.stringify(config, null, 2));
renameSync(tempFile, this.playbackStateFile);
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–º–æ-—Ä–µ–∂–∏–º–∞
```javascript
// config-sync.service.js
if (appState.isDemoModeEnabled()) return; // –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –¥–µ–º–æ
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
```bash
‚úÖ node --check server.js
‚úÖ node --check storage.js
‚úÖ node --check src/routes/config.routes.js
‚úÖ node --check src/controllers/config.controller.js
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–ø–ª–∞–Ω):

1. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä: `npm start`
2. ‚úÖ –û—Ç–∫—Ä—ã—Ç—å –±—Ä–∞—É–∑–µ—Ä: `http://localhost:3000`
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø–ª–µ–µ—Ä
4. ‚úÖ –í—ã–±—Ä–∞—Ç—å —Ç—Ä–µ–∫ –¥–ª—è –ø–ª–µ–µ—Ä–∞
5. ‚úÖ –í–∫–ª—é—á–∏—Ç—å Loop Mode
6. ‚úÖ –ò–∑–º–µ–Ω–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å
7. ‚úÖ –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É –ø–ª–µ–µ—Ä–æ–≤
8. ‚úÖ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
9. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å—ë –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å
10. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã: `cat data/playback-state.json data/ui-config.json`

---

## üìù –ò–ó–ú–ï–ù–Å–ù–ù–´–ï –§–ê–ô–õ–´

| –§–∞–π–ª | –ë—ã–ª–æ —Å—Ç—Ä–æ–∫ | –°—Ç–∞–ª–æ —Å—Ç—Ä–æ–∫ | –î–æ–±–∞–≤–ª–µ–Ω–æ |
|------|-----------|-------------|-----------|
| `storage.js` | 425 | 471 | +46 |
| `src/routes/config.routes.js` | 37 | 66 | +29 |
| `src/controllers/config.controller.js` | 65 | 151 | +86 |
| **–ò–¢–û–ì–û** | 527 | 688 | **+161** |

---

## üéâ –ì–û–¢–û–í–û

–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å **–ö–û–†–†–ï–ö–¢–ù–û –°–û–•–†–ê–ù–Ø–Æ–¢–°–Ø** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ!

–ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è:
- ‚úÖ –í—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç—Ä–µ–∫–∏ –¥–ª—è –ø–ª–µ–µ—Ä–æ–≤
- ‚úÖ –ì—Ä—É–ø–ø—ã –ø–ª–µ–µ—Ä–æ–≤
- ‚úÖ –†–µ–∂–∏–º—ã –ø–æ–≤—Ç–æ—Ä–∞ (Loop Mode)
- ‚úÖ –ì—Ä–æ–º–∫–æ—Å—Ç–∏ –ø–ª–µ–µ—Ä–æ–≤
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

*–°–æ–∑–¥–∞–Ω–æ: 2025-12-21*
