# –°–≤–æ–¥–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º

**–î–∞—Ç–∞:** 2025-12-21

---

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

### 1. –î–≤–æ–π–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `getConfig()` –≤—ã–∑—ã–≤–∞–ª—Å—è –¥–≤–∞–∂–¥—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ü–µ—Ä–≤—ã–π —Ä–∞–∑ –≤ `app-main.js:150`
- –í—Ç–æ—Ä–æ–π —Ä–∞–∑ –≤ `loadPlayerGroups()` ‚Üí `groups-ui.js:190`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –ò–∑–º–µ–Ω–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `loadPlayerGroups()` –¥–ª—è –ø—Ä–∏—ë–º–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `playerGroups`
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞–Ω—ã - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Ö –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞
- –ï—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã - –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É

**–§–∞–π–ª—ã:**
- `public/js/ui/groups-ui.js:188-208` - –¥–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä
- `public/js/app-main.js:178` - –ø–µ—Ä–µ–¥–∞—ë–º `config.playerGroups`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –û–¥–∏–Ω HTTP –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ –¥–≤—É—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

### 2. –ü–æ–∫–∞–∑ –æ—à–∏–±–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –û—à–∏–±–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –≤ `console.error()`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ù–ï —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏—Å—å

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `addMessage()` –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤:
- `savePlayerSelections()` - "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—ã–±–æ—Ä —Ñ–∞–π–ª–æ–≤"
- `saveLoopModes()` - "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å Loop —Ä–µ–∂–∏–º—ã"
- `saveVolumes()` - "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç–∏"
- `savePlayerGroups()` - "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≥—Ä—É–ø–ø—ã –ø–ª–µ–µ—Ä–æ–≤"

**–§–∞–π–ª:**
- `public/js/services/config-sync.service.js` (—Å—Ç—Ä–æ–∫–∏ 33-35, 58-60, 85-87, 109-111)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –æ—à–∏–±–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- ‚úÖ –ü–æ–Ω–∏–º–∞–µ—Ç —á—Ç–æ –Ω—É–∂–Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞

---

### 3. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –≤–º–µ—Å—Ç–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –≥—Ä—É–ø–ø—ã/–≤—Å–µ—Ö –ø–ª–µ–µ—Ä–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- 5 –ø–ª–µ–µ—Ä–æ–≤ = 10 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ (5√ó setLoopMode + 5√ó playMedia)
- –í–æ–∑–º–æ–∂–Ω–∞—è –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ WiiM —É—Å—Ç—Ä–æ–π—Å—Ç–≤

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

#### a) –ó–∞–ø—É—Å–∫ –≥—Ä—É–ø–ø—ã (`groups-ui.js:131-153`)

**–ë–´–õ–û:**
```javascript
await Promise.all(
  playersWithFiles.map(async playerId => {
    await setLoopMode(playerId, loopMode);
    return playMedia(playerId, fileUrl);
  })
);
```

**–°–¢–ê–õ–û:**
```javascript
for (const playerId of playersWithFiles) {
  await setLoopMode(playerId, loopMode);
  await new Promise(resolve => setTimeout(resolve, 100)); // –ü–∞—É–∑–∞ 100ms
  await playMedia(playerId, fileUrl);
  await new Promise(resolve => setTimeout(resolve, 150)); // –ü–∞—É–∑–∞ 150ms –º–µ–∂–¥—É –ø–ª–µ–µ—Ä–∞–º–∏
}
```

#### b) –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –ø–ª–µ–µ—Ä–æ–≤ (`player-service.js:90-126`)

**–ë–´–õ–û:**
```javascript
const results = await Promise.allSettled(
  playersWithSelection.map(async player => {
    await setLoopMode(player.id, loopMode);
    return playMedia(player.id, fileUrl);
  })
);
```

**–°–¢–ê–õ–û:**
```javascript
for (const player of playersWithSelection) {
  try {
    await setLoopMode(player.id, loopMode);
    await new Promise(resolve => setTimeout(resolve, 100)); // –ü–∞—É–∑–∞ 100ms
    await playMedia(player.id, fileUrl);
    successful++;
    await new Promise(resolve => setTimeout(resolve, 150)); // –ü–∞—É–∑–∞ 150ms
  } catch (error) {
    failed++;
  }
}
```

**–ó–∞–¥–µ—Ä–∂–∫–∏:**
- **100ms** –ø–æ—Å–ª–µ `setLoopMode` –ø–µ—Ä–µ–¥ `playMedia` - –¥–∞—ë—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–º–∞–Ω–¥—É
- **150ms** –º–µ–∂–¥—É –ø–ª–µ–µ—Ä–∞–º–∏ - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫—É —Å–µ—Ç–∏

**–î–ª—è 5 –ø–ª–µ–µ—Ä–æ–≤:**
- –û–±—â–µ–µ –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞: ~1.25 —Å–µ–∫—É–Ω–¥—ã (–≤–º–µ—Å—Ç–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ ~0.5 —Å–µ–∫)
- **–≠—Ç–æ –ø—Ä–∏–µ–º–ª–µ–º–æ** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–º–µ—Ç–∏—Ç —Ä–∞–∑–Ω–∏—Ü—ã

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –°–Ω–∏–∂–µ–Ω–∞ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω—ã –≤–æ–∑–º–æ–∂–Ω—ã–µ race conditions
- ‚úÖ –ë–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω—ã–π –∑–∞–ø—É—Å–∫ –≥—Ä—É–ø–ø

---

## üìä –ò–¢–û–ì–ò

### –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª—ã |
|----------|--------|-------|
| –î–≤–æ–π–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ config | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | groups-ui.js, app-main.js |
| –û—à–∏–±–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–≤–∏–¥–∏–º—ã | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | config-sync.service.js |
| –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | groups-ui.js, player-service.js |

### –ß—Ç–æ –æ—Å—Ç–∞–≤–ª–µ–Ω–æ –∫–∞–∫ –µ—Å—Ç—å (–ø–æ —Ä–µ—à–µ–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è):

| –ü–æ–≤–µ–¥–µ–Ω–∏–µ | –ü—Ä–∏—á–∏–Ω–∞ |
|-----------|---------|
| Loop Mode –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é = 2 | –ù–∞–º–µ—Ä–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - –≤—Å–µ–≥–¥–∞ –ø–æ–≤—Ç–æ—Ä |
| refresh –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ | –¢—Ä–µ–±—É–µ—Ç—Å—è —É—Ç–æ—á–Ω–µ–Ω–∏–µ |
| –î–µ–º–æ-—Ä–µ–∂–∏–º –Ω–µ –≤–µ–∑–¥–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è | –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç |

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –¢—Ä–µ–±—É—é—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è:

**1. refresh –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏**

–°–µ–π—á–∞—Å –ø–æ—Å–ª–µ `playAll()`, `stopAll()`, `playPlayer()`, `stopPlayer()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `refreshAllPlayers()` ‚Üí 5 HTTP –∑–∞–ø—Ä–æ—Å–æ–≤.

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
- A) –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI)
- B) –£–±—Ä–∞—Ç—å (–ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ adaptive refresh –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫)
- C) –û–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–π –ø–ª–µ–µ—Ä

**–í–æ–ø—Ä–æ—Å:** –ß—Ç–æ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ?

---

**2. –î–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≥—Ä–æ–º–∫–æ—Å—Ç–∏**

–ï—Å—Ç—å `setVolume()` –∏ `setPlayerVolume()` - –ø–æ—á—Ç–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ, –Ω–æ `setVolume()` –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

**–í–æ–ø—Ä–æ—Å:** –£–¥–∞–ª–∏—Ç—å `setVolume()` –∫–∞–∫ –∏–∑–±—ã—Ç–æ—á–Ω—É—é –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å?

---

**3. –î–µ–º–æ-—Ä–µ–∂–∏–º –≤ bulk-–æ–ø–µ—Ä–∞—Ü–∏—è—Ö**

`playAll()` –∏ `stopAll()` –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –¥–µ–º–æ-—Ä–µ–∂–∏–º –≤ –Ω–∞—á–∞–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–ø–æ–ª–∞–≥–∞—é—Ç—Å—è –Ω–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã).

**–í–æ–ø—Ä–æ—Å:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å?

---

## üìÅ –ò–ó–ú–ï–ù–Å–ù–ù–´–ï –§–ê–ô–õ–´

1. `public/js/ui/groups-ui.js` - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –≥—Ä—É–ø–ø—ã (+20 —Å—Ç—Ä–æ–∫)
2. `public/js/services/player-service.js` - –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö (+28 —Å—Ç—Ä–æ–∫)
3. `public/js/services/config-sync.service.js` - –ø–æ–∫–∞–∑ –æ—à–∏–±–æ–∫ (+16 —Å—Ç—Ä–æ–∫)
4. `public/js/app-main.js` - –ø–µ—Ä–µ–¥–∞—á–∞ playerGroups (-1 –¥—É–±–ª–∏—Ä—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å)

**–í—Å–µ–≥–æ:** +64 —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞, -1 HTTP –∑–∞–ø—Ä–æ—Å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

---

*–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã: 2025-12-21*
